<!DOCTYPE html>
<html lang="sw" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Pata nyumba bora Tanzania - Bedsitter, Chumba, Apartment Dar es Salaam, Arusha, Mwanza" />
  <meta name="theme-color" content="#0d9488" />
  <title>HouseLink - Nyumba Bora Tanzania</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"HouseLink\",\"short_name\":\"HouseLink\",\"start_url\":\".\",\"display\":\"standalone\",\"background_color\":\"#0d9488\",\"theme_color\":\"#0d9488\",\"icons\":[{\"src\":\"https://via.placeholder.com/192/0d9488/ffffff?text=HL\",\"sizes\":\"192x192\",\"type\":\"image/png\"},{\"src\":\"https://via.placeholder.com/512/0d9488/ffffff?text=HL\",\"sizes\":\"512x512\",\"type\":\"image/png\"}]}">
  <link rel="icon" href="https://via.placeholder.com/64/0d9488/ffffff?text=HL" />
  <link rel="apple-touch-icon" href="https://via.placeholder.com/180/0d9488/ffffff?text=HL" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Leaflet CSS for Maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Date Range Picker -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #0d9488;
      --primary-dark: #0f766e;
      --secondary: #3b82f6;
      --accent: #f59e0b;
      --danger: #ef4444;
      --success: #10b981;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }
    
    .gradient-bg { 
      background: linear-gradient(135deg, var(--primary) 0%, #14b8a6 100%);
    }
    
    .card-hover { 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    
    .card-hover:hover { 
      transform: translateY(-8px); 
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); 
    }
    
    .toast { 
      animation: slideIn 0.3s ease-out; 
    }
    
    @keyframes slideIn { 
      from { transform: translateY(100px); opacity: 0; } 
      to { transform: translateY(0); opacity: 1; }
    }
    
    .skeleton { 
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); 
      background-size: 200% 100%; 
      animation: loading 1.5s infinite; 
    }
    
    @keyframes loading { 
      0% { background-position: 200% 0; } 
      100% { background-position: -200% 0; }
    }
    
    /* Map Container */
    #map, .map-container {
      height: 400px;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      z-index: 1;
    }
    
    .leaflet-container {
      font-family: 'Inter', sans-serif !important;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
    
    /* Price Range Slider */
    .price-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 5px;
      background: #e2e8f0;
      outline: none;
    }
    
    .price-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    
    /* Rating Stars */
    .rating-stars {
      display: inline-flex;
      direction: ltr;
    }
    
    .rating-stars input {
      display: none;
    }
    
    .rating-stars label {
      color: #ddd;
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .rating-stars input:checked ~ label,
    .rating-stars label:hover,
    .rating-stars label:hover ~ label {
      color: #fbbf24;
    }
    
    /* Image Gallery */
    .image-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
    
    .gallery-main {
      height: 400px;
      position: relative;
      overflow: hidden;
      border-radius: 12px;
    }
    
    .gallery-main img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }
    
    .gallery-thumbnail {
      height: 80px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .gallery-thumbnail.active {
      border-color: var(--primary);
    }
    
    .gallery-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Calendar */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    
    .calendar-day {
      padding: 8px;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .calendar-day:hover:not(.disabled) {
      background: #f1f5f9;
    }
    
    .calendar-day.selected {
      background: var(--primary);
      color: white;
    }
    
    .calendar-day.disabled {
      color: #cbd5e1;
      cursor: not-allowed;
    }
    
    /* Verification Badge */
    .verified-badge {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    /* Loading Animation */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Property Features Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    
    .feature-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #f8fafc;
      border-radius: 8px;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      
      .gallery-main {
        height: 300px;
      }
      
      #map {
        height: 300px;
      }
    }
    
    /* Print Styles */
    @media print {
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div id="root"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Date Range Picker -->
  <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <!-- React Libraries -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/react-router-dom@5/umd/react-router-dom.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useContext, createContext, useRef, useCallback } = React;
    const { HashRouter, Route, Switch, Link, useParams, useHistory, Redirect } = ReactRouterDOM;

    // ==================== CONFIGURATION ====================
    const CONFIG = {
      CLOUDINARY: { CLOUD_NAME: '', UPLOAD_PRESET: '' },
      LOCATIONS: [
        "Sinza", "Ubungo", "Mbezi", "Tegeta", "Masaki", "Upanga", "Kariakoo", 
        "Kinondoni", "Mwenge", "Posta", "Oysterbay", "Kawe", "Mikocheni", 
        "Regent Estate", "Ada Estate", "Namanga", "Ilala", "Buguruni", 
        "Gongo la Mboto", "Kimara", "Mbagala", "Ukonga", "Vingunguti", 
        "Tabata", "Manzele", "Kigamboni", "Bunju", "Bagamoyo Road", 
        "Morogoro Road", "Nyerere Road", "Mlimani City", "Magomeni", 
        "Temeke", "Chang'ombe", "Mwananyamala", "Tabata", "Kijitonyama"
      ],
      PROPERTY_TYPES: ["Bedsitter", "Single Room", "Apartment", "Studio", "Duplex", "House", "Commercial Space"],
      BEDROOMS: ["Studio", "1", "2", "3", "4", "5+"],
      BATHROOMS: ["1", "2", "3", "4", "5+"],
      AMENITIES: [
        { id: "water", label: "Maji 24/7", icon: "fa-tint" },
        { id: "security", label: "Ulinzi", icon: "fa-shield-alt" },
        { id: "parking", label: "Parking", icon: "fa-car" },
        { id: "wifi", label: "Wi-Fi", icon: "fa-wifi" },
        { id: "generator", label: "Jenereta", icon: "fa-bolt" },
        { id: "furnished", label: "Samani", icon: "fa-couch" },
        { id: "gym", label: "Gym", icon: "fa-dumbbell" },
        { id: "pool", label: "Bwawa", icon: "fa-swimming-pool" },
        { id: "elevator", label: "Lifti", icon: "fa-elevator" },
        { id: "garden", label: "Bustani", icon: "fa-seedling" },
        { id: "balcony", label: "Rooftop/Balcony", icon: "fa-building" },
        { id: "cctv", label: "CCTV", icon: "fa-video" }
      ],
      PRICE_RANGES: [
        { label: "Chini ya 100,000", min: 0, max: 100000 },
        { label: "100,000 - 300,000", min: 100000, max: 300000 },
        { label: "300,000 - 600,000", min: 300000, max: 600000 },
        { label: "600,000 - 1,000,000", min: 600000, max: 1000000 },
        { label: "Zaidi ya 1,000,000", min: 1000000, max: 10000000 }
      ],
      // Map coordinates for major locations in Dar es Salaam
      LOCATION_COORDINATES: {
        "Sinza": [-6.7924, 39.2083],
        "Masaki": [-6.7950, 39.2750],
        "Kariakoo": [-6.8167, 39.2833],
        "Mbezi": [-6.7667, 39.2167],
        "Ubungo": [-6.7833, 39.2333],
        "Mikocheni": [-6.8000, 39.2500],
        "Oysterbay": [-6.7800, 39.2700],
        "Ilala": [-6.9000, 39.2833],
        "Temeke": [-6.8333, 39.2833],
        "Kigamboni": [-6.8500, 39.3000]
      }
    };

    // ==================== LOCAL STORAGE KEYS ====================
    const LS = { 
      LISTINGS: 'hl:listings:v20', 
      FAVS: 'hl:favs:v20', 
      THEME: 'hl:theme', 
      LANG: 'hl:lang', 
      RECENT: 'hl:recent:v20',
      USER: 'hl:user:v20',
      SEARCH_HISTORY: 'hl:search_history:v20'
    };

    // ==================== HELPER FUNCTIONS ====================
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, def) => { 
      try { 
        return JSON.parse(localStorage.getItem(k)) || def; 
      } catch { 
        return def; 
      }
    };

    // Format price with commas
    const formatPrice = (price) => {
      return new Intl.NumberFormat('sw-TZ', {
        style: 'currency',
        currency: 'TZS',
        minimumFractionDigits: 0
      }).format(price);
    };

    // Get coordinates for a location
    const getCoordinates = (location) => {
      return CONFIG.LOCATION_COORDINATES[location] || [-6.7924, 39.2083]; // Default to Sinza
    };

    // ==================== TRANSLATIONS ====================
    const translations = {
      sw: {
        // ... (keep existing translations)
        // Add new translations
        mapView: "Ramani",
        listView: "Orodha",
        filters: "Vichujio",
        clearAll: "Futa Yote",
        bedrooms: "Vyumba vya kulala",
        bathrooms: "Bafu",
        area: "Eneo (m²)",
        yearBuilt: "Imejengwa",
        availableFrom: "Inapatikana",
        scheduleViewing: "Panga Uangalizi",
        requestTour: "Omba Ziara",
        contactAgent: "Wasiliana na Wakala",
        virtualTour: "Ziara Mtandaoni",
        saveSearch: "Hifadhi Utafutaji",
        share: "Shiriki",
        print: "Print",
        download: "Pakua",
        reportListing: "Ripoti Tangazo",
        similarProperties: "Nyumba Zinazofanana",
        neighborhood: "Mtaa",
        schools: "Shule",
        hospitals: "Hospitali",
        supermarkets: "Maduka",
        transport: "Usafiri",
        ratings: "Ukadiriaji",
        reviews: "Maoni",
        writeReview: "Andika Ukadiriaji",
        verifiedLandlord: "Mmiliki Aliyethibitishwa",
        verifiedAgent: "Wakala Aliyethibitishwa",
        trustScore: "Alama ya Uaminifu",
        bookingFee: "Ada ya Kuhifadhi",
        deposit: "Amana",
        utilities: "Matumizi",
        petFriendly: "Inakubali wanyama",
        smoking: "Inaruhusu kuvuta sigara",
        furnished: "Imevalishwa",
        unfurnished: "Haijavalishwa",
        partiallyFurnished: "Imevalishwa kiasi",
        mortgage: "Mikopo ya Nyumba",
        insurance: "Bima",
        legalServices: "Huduma za Kisheria",
        mortgageCalculator: "Kikokotoo cha Mikopo",
        affordabilityCalculator: "Kikokotoo cha Uwezo",
        movingChecklist: "Orodha ya Kuhamia",
        rentalAgreement: "Makubaliano ya Kukodisha",
        safetyTips: "Vidokezo vya Usalama",
        scamAlerts: "Taarifa za Udanganyifu",
        marketTrends: "Mienendo ya Soko",
        priceHistory: "Historia ya Bei",
        demandIndex: "Kiashiria cha Mahitaji",
        popularAreas: "Maeneo Yanayopendwa",
        investmentTips: "Vidokezo vya Uwekezaji",
        taxInfo: "Taarifa za Kodi",
        landlordGuide: "Mwongozo wa Wamiliki",
        tenantGuide: "Mwongozo wa Wakodiji",
        firstTimeBuyer: "Wanunuzi wa Kwanza",
        propertyManagement: "Usimamizi wa Mali",
        maintenanceRequest: "Ombi la Matengenezo",
        emergencyContacts: "Mawasiliano ya Dharura",
        community: "Jumuiya",
        events: "Matukio",
        forum: "Jukwaa",
        blog: "Blogu",
        newsletter: "Barua pepe",
        career: "Kazi",
        aboutUs: "Kuhusu Sisi",
        contactUs: "Wasiliana Nasi",
        privacyPolicy: "Sera ya Faragha",
        terms: "Masharti",
        cookies: "Cookies",
        sitemap: "Ramani ya Tovuti",
        faq: "Maswali Yanayoulizwa Mara kwa Mara",
        helpCenter: "Kituo cha Usaidizi",
        liveChat: "Mazungumzo ya Moja kwa Moja",
        phoneSupport: "Msaada wa Simu",
        emailSupport: "Msaada wa Barua pepe"
      },
      en: {
        // ... (keep existing translations)
        // Add new translations
        mapView: "Map View",
        listView: "List View",
        filters: "Filters",
        clearAll: "Clear All",
        bedrooms: "Bedrooms",
        bathrooms: "Bathrooms",
        area: "Area (m²)",
        yearBuilt: "Year Built",
        availableFrom: "Available From",
        scheduleViewing: "Schedule Viewing",
        requestTour: "Request Tour",
        contactAgent: "Contact Agent",
        virtualTour: "Virtual Tour",
        saveSearch: "Save Search",
        share: "Share",
        print: "Print",
        download: "Download",
        reportListing: "Report Listing",
        similarProperties: "Similar Properties",
        neighborhood: "Neighborhood",
        schools: "Schools",
        hospitals: "Hospitals",
        supermarkets: "Supermarkets",
        transport: "Transport",
        ratings: "Ratings",
        reviews: "Reviews",
        writeReview: "Write Review",
        verifiedLandlord: "Verified Landlord",
        verifiedAgent: "Verified Agent",
        trustScore: "Trust Score",
        bookingFee: "Booking Fee",
        deposit: "Deposit",
        utilities: "Utilities",
        petFriendly: "Pet Friendly",
        smoking: "Smoking Allowed",
        furnished: "Furnished",
        unfurnished: "Unfurnished",
        partiallyFurnished: "Partially Furnished",
        mortgage: "Mortgage",
        insurance: "Insurance",
        legalServices: "Legal Services",
        mortgageCalculator: "Mortgage Calculator",
        affordabilityCalculator: "Affordability Calculator",
        movingChecklist: "Moving Checklist",
        rentalAgreement: "Rental Agreement",
        safetyTips: "Safety Tips",
        scamAlerts: "Scam Alerts",
        marketTrends: "Market Trends",
        priceHistory: "Price History",
        demandIndex: "Demand Index",
        popularAreas: "Popular Areas",
        investmentTips: "Investment Tips",
        taxInfo: "Tax Information",
        landlordGuide: "Landlord Guide",
        tenantGuide: "Tenant Guide",
        firstTimeBuyer: "First Time Buyer",
        propertyManagement: "Property Management",
        maintenanceRequest: "Maintenance Request",
        emergencyContacts: "Emergency Contacts",
        community: "Community",
        events: "Events",
        forum: "Forum",
        blog: "Blog",
        newsletter: "Newsletter",
        career: "Career",
        aboutUs: "About Us",
        contactUs: "Contact Us",
        privacyPolicy: "Privacy Policy",
        terms: "Terms",
        cookies: "Cookies",
        sitemap: "Sitemap",
        faq: "FAQ",
        helpCenter: "Help Center",
        liveChat: "Live Chat",
        phoneSupport: "Phone Support",
        emailSupport: "Email Support"
      }
    };

    // ==================== CONTEXTS & HOOKS ====================
    const ToastContext = createContext();
    const AuthContext = createContext();
    const MapContext = createContext();

    // Toast Provider
    const ToastProvider = ({ children }) => {
      const [toasts, setToasts] = useState([]);
      const push = useCallback((msg, opts = {}) => {
        const id = Date.now();
        setToasts(t => [...t, { id, msg, ...opts }]);
        setTimeout(() => setToasts(t => t.filter(x => x.id !== id)), 4000);
      }, []);
      
      return (
        <ToastContext.Provider value={{ push }}>
          {children}
          <div className="fixed bottom-4 right-4 z-50 space-y-3 max-w-sm">
            {toasts.map(t => (
              <div key={t.id} className={`toast p-4 rounded-xl shadow-2xl text-white font-bold ${t.variant === 'error' ? 'bg-red-600' : t.variant === 'success' ? 'bg-green-600' : 'bg-teal-600'}`}>
                <div className="flex items-center gap-2">
                  {t.variant === 'success' && <i className="fas fa-check-circle"></i>}
                  {t.variant === 'error' && <i className="fas fa-exclamation-circle"></i>}
                  {t.variant === 'info' && <i className="fas fa-info-circle"></i>}
                  <span>{t.msg}</span>
                </div>
              </div>
            ))}
          </div>
        </ToastContext.Provider>
      );
    };

    // Auth Provider
    const AuthProvider = ({ children }) => {
      const [user, setUser] = useState(() => load(LS.USER, null));
      const toast = useToast();
      
      const login = useCallback((userData) => {
        setUser(userData);
        save(LS.USER, userData);
        toast("Umeingia kikamilifu", { variant: 'success' });
      }, [toast]);
      
      const logout = useCallback(() => {
        setUser(null);
        save(LS.USER, null);
        toast("Umetoka", { variant: 'info' });
      }, [toast]);
      
      return (
        <AuthContext.Provider value={{ user, login, logout }}>
          {children}
        </AuthContext.Provider>
      );
    };

    // Map Provider
    const MapProvider = ({ children }) => {
      const [mapInstance, setMapInstance] = useState(null);
      const [selectedLocation, setSelectedLocation] = useState(null);
      
      const initMap = useCallback((elementId, coordinates, zoom = 13) => {
        if (!elementId) return null;
        
        const map = L.map(elementId).setView(coordinates, zoom);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors',
          maxZoom: 19
        }).addTo(map);
        
        setMapInstance(map);
        return map;
      }, []);
      
      const addMarker = useCallback((coordinates, title, color = 'blue') => {
        if (!mapInstance) return;
        
        const marker = L.marker(coordinates).addTo(mapInstance);
        marker.bindPopup(`<b>${title}</b>`);
        
        return marker;
      }, [mapInstance]);
      
      const setView = useCallback((coordinates, zoom = 13) => {
        if (mapInstance) {
          mapInstance.setView(coordinates, zoom);
        }
      }, [mapInstance]);
      
      return (
        <MapContext.Provider value={{ 
          mapInstance, 
          selectedLocation, 
          setSelectedLocation,
          initMap, 
          addMarker, 
          setView 
        }}>
          {children}
        </MapContext.Provider>
      );
    };

    // Custom Hooks
    const useToast = () => useContext(ToastContext).push;
    const useAuth = () => useContext(AuthContext);
    const useMap = () => useContext(MapContext);

    // ==================== MAP COMPONENT ====================
    const PropertyMap = ({ properties, selectedProperty, onPropertySelect }) => {
      const mapRef = useRef(null);
      const { initMap, addMarker, setView } = useMap();
      const [map, setMap] = useState(null);
      const [markers, setMarkers] = useState([]);
      
      useEffect(() => {
        if (!mapRef.current) return;
        
        const mapInstance = initMap(mapRef.current, [-6.7924, 39.2083], 12);
        setMap(mapInstance);
        
        return () => {
          if (mapInstance) {
            mapInstance.remove();
          }
        };
      }, [initMap]);
      
      useEffect(() => {
        if (!map || !properties.length) return;
        
        // Clear existing markers
        markers.forEach(marker => marker.remove());
        
        const newMarkers = properties.map(property => {
          const coords = getCoordinates(property.location);
          const marker = addMarker(coords, property.title);
          
          marker.on('click', () => {
            if (onPropertySelect) {
              onPropertySelect(property);
            }
          });
          
          return marker;
        });
        
        setMarkers(newMarkers);
        
        // Fit bounds to show all markers
        if (properties.length > 1) {
          const bounds = L.latLngBounds(newMarkers.map(m => m.getLatLng()));
          map.fitBounds(bounds, { padding: [50, 50] });
        }
        
      }, [map, properties, addMarker, onPropertySelect]);
      
      useEffect(() => {
        if (!map || !selectedProperty) return;
        
        const coords = getCoordinates(selectedProperty.location);
        setView(coords, 15);
        
      }, [selectedProperty, map, setView]);
      
      return <div id="map" ref={mapRef} className="w-full h-full"></div>;
    };

    // ==================== ADVANCED FILTERS COMPONENT ====================
    const AdvancedFilters = ({ filters, onFilterChange, onClearFilters }) => {
      const [showAdvanced, setShowAdvanced] = useState(false);
      
      return (
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-semibold">Chuja Nyumba</h3>
            <div className="flex gap-2">
              <button 
                onClick={() => setShowAdvanced(!showAdvanced)}
                className="text-sm text-teal-600 hover:text-teal-700 font-medium"
              >
                {showAdvanced ? 'Ficha' : 'Onesha Zaidi'}
              </button>
              <button 
                onClick={onClearFilters}
                className="text-sm text-gray-600 hover:text-gray-800"
              >
                Futa Yote
              </button>
            </div>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Eneo</label>
              <select 
                value={filters.location || ''}
                onChange={(e) => onFilterChange('location', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-lg"
              >
                <option value="">Chagua Eneo</option>
                {CONFIG.LOCATIONS.map(loc => (
                  <option key={loc} value={loc}>{loc}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Aina ya Nyumba</label>
              <select 
                value={filters.type || ''}
                onChange={(e) => onFilterChange('type', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-lg"
              >
                <option value="">Aina Zote</option>
                {CONFIG.PROPERTY_TYPES.map(type => (
                  <option key={type} value={type}>{type}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Bei (TZS)</label>
              <div className="flex gap-2">
                <input 
                  type="number" 
                  placeholder="Chini"
                  value={filters.minPrice || ''}
                  onChange={(e) => onFilterChange('minPrice', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-lg"
                />
                <input 
                  type="number" 
                  placeholder="Juu"
                  value={filters.maxPrice || ''}
                  onChange={(e) => onFilterChange('maxPrice', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-lg"
                />
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Vitengo</label>
              <select 
                value={filters.bedrooms || ''}
                onChange={(e) => onFilterChange('bedrooms', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-lg"
              >
                <option value="">Vyumba Vyote</option>
                {CONFIG.BEDROOMS.map(bed => (
                  <option key={bed} value={bed}>{bed} {bed === 'Studio' ? '' : 'Bedroom' + (bed !== '1' ? 's' : '')}</option>
                ))}
              </select>
            </div>
          </div>
          
          {showAdvanced && (
            <div className="border-t pt-4">
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Bafu</label>
                  <select 
                    value={filters.bathrooms || ''}
                    onChange={(e) => onFilterChange('bathrooms', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded-lg"
                  >
                    <option value="">Zote</option>
                    {CONFIG.BATHROOMS.map(bath => (
                      <option key={bath} value={bath}>{bath} Bathroom{bath !== '1' ? 's' : ''}</option>
                    ))}
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Eneo (m²)</label>
                  <div className="flex gap-2">
                    <input 
                      type="number" 
                      placeholder="Chini"
                      value={filters.minArea || ''}
                      onChange={(e) => onFilterChange('minArea', e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    />
                    <input 
                      type="number" 
                      placeholder="Juu"
                      value={filters.maxArea || ''}
                      onChange={(e) => onFilterChange('maxArea', e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Imejengwa</label>
                  <input 
                    type="number" 
                    placeholder="Mwaka"
                    value={filters.yearBuilt || ''}
                    onChange={(e) => onFilterChange('yearBuilt', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded-lg"
                    min="1900"
                    max={new Date().getFullYear()}
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Inapatikana</label>
                  <input 
                    type="date" 
                    value={filters.availableFrom || ''}
                    onChange={(e) => onFilterChange('availableFrom', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded-lg"
                  />
                </div>
              </div>
              
              <div className="mb-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">Vifaa na Huduma</label>
                <div className="grid grid-cols-2 md:grid-cols-6 gap-2">
                  {CONFIG.AMENITIES.map(amenity => (
                    <label key={amenity.id} className="flex items-center gap-2">
                      <input 
                        type="checkbox" 
                        checked={filters.amenities?.includes(amenity.id) || false}
                        onChange={(e) => {
                          const newAmenities = e.target.checked
                            ? [...(filters.amenities || []), amenity.id]
                            : (filters.amenities || []).filter(a => a !== amenity.id);
                          onFilterChange('amenities', newAmenities);
                        }}
                        className="rounded text-teal-600"
                      />
                      <span className="text-sm">{amenity.label}</span>
                    </label>
                  ))}
                </div>
              </div>
              
              <div className="flex justify-between">
                <div>
                  <label className="flex items-center gap-2">
                    <input 
                      type="checkbox" 
                      checked={filters.petFriendly || false}
                      onChange={(e) => onFilterChange('petFriendly', e.target.checked)}
                      className="rounded text-teal-600"
                    />
                    <span className="text-sm">Inakubali Wanyama</span>
                  </label>
                </div>
                
                <div>
                  <label className="flex items-center gap-2">
                    <input 
                      type="checkbox" 
                      checked={filters.furnished || false}
                      onChange={(e) => onFilterChange('furnished', e.target.checked)}
                      className="rounded text-teal-600"
                    />
                    <span className="text-sm">Imevalishwa</span>
                  </label>
                </div>
                
                <div>
                  <label className="flex items-center gap-2">
                    <input 
                      type="checkbox" 
                      checked={filters.verifiedOnly || false}
                      onChange={(e) => onFilterChange('verifiedOnly', e.target.checked)}
                      className="rounded text-teal-600"
                    />
                    <span className="text-sm">Zilizothibitishwa Pekee</span>
                  </label>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ==================== SCHEDULE VIEWING MODAL ====================
    const ScheduleViewingModal = ({ property, isOpen, onClose, onSchedule }) => {
      const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        preferredDate: '',
        preferredTime: '09:00',
        message: ''
      });
      
      const handleSubmit = (e) => {
        e.preventDefault();
        onSchedule(formData);
        onClose();
      };
      
      if (!isOpen) return null;
      
      return (
        <div className="modal-overlay active">
          <div className="modal-content w-full max-w-md">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold">Panga Uangalizi</h3>
                <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                  <i className="fas fa-times"></i>
                </button>
              </div>
              
              <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                <h4 className="font-semibold mb-2">{property.title}</h4>
                <p className="text-sm text-gray-600">{property.location}</p>
                <p className="text-lg font-bold text-teal-600 mt-2">{formatPrice(property.price)}/mwezi</p>
              </div>
              
              <form onSubmit={handleSubmit}>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Jina Kamili *</label>
                    <input 
                      type="text" 
                      required
                      value={formData.name}
                      onChange={(e) => setFormData({...formData, name: e.target.value})}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Namba ya Simu *</label>
                    <input 
                      type="tel" 
                      required
                      value={formData.phone}
                      onChange={(e) => setFormData({...formData, phone: e.target.value})}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Barua Pepe</label>
                    <input 
                      type="email" 
                      value={formData.email}
                      onChange={(e) => setFormData({...formData, email: e.target.value})}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Tarehe *</label>
                      <input 
                        type="date" 
                        required
                        value={formData.preferredDate}
                        onChange={(e) => setFormData({...formData, preferredDate: e.target.value})}
                        className="w-full p-2 border border-gray-300 rounded-lg"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Muda *</label>
                      <select 
                        value={formData.preferredTime}
                        onChange={(e) => setFormData({...formData, preferredTime: e.target.value})}
                        className="w-full p-2 border border-gray-300 rounded-lg"
                      >
                        <option value="09:00">09:00 asubuhi</option>
                        <option value="10:00">10:00 asubuhi</option>
                        <option value="11:00">11:00 asubuhi</option>
                        <option value="12:00">12:00 alasiri</option>
                        <option value="14:00">14:00 alasiri</option>
                        <option value="15:00">15:00 alasiri</option>
                        <option value="16:00">16:00 alasiri</option>
                      </select>
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Ujumbe (Hiari)</label>
                    <textarea 
                      value={formData.message}
                      onChange={(e) => setFormData({...formData, message: e.target.value})}
                      rows="3"
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    ></textarea>
                  </div>
                  
                  <div className="flex gap-3 pt-4">
                    <button type="submit" className="flex-1 bg-teal-600 text-white py-3 rounded-lg font-semibold hover:bg-teal-700">
                      Wasilisha Ombi
                    </button>
      
// Continuation from where we left off...

                    <button type="button" onClick={onClose} className="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                      Ghairi
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      );
    };

    // ==================== PROPERTY DETAIL COMPONENT ====================
    const PropertyDetail = ({ property, t }) => {
      const [activeImage, setActiveImage] = useState(0);
      const [showScheduleModal, setShowScheduleModal] = useState(false);
      const [showMap, setShowMap] = useState(false);
      const [similarProperties, setSimilarProperties] = useState([]);
      const toast = useToast();
      const history = useHistory();
      const { user } = useAuth();
      const mapRef = useRef(null);
      
      // Social Proof & Trust Elements
      const [reviews, setReviews] = useState([
        { id: 1, name: "John M.", rating: 5, comment: "Nyumba nzuri sana, mmiliki mwema", date: "2024-01-15", verified: true },
        { id: 2, name: "Sarah K.", rating: 4, comment: "Eneo salama na karibu na usafiri", date: "2024-01-10", verified: true },
        { id: 3, name: "Michael T.", rating: 5, comment: "Huduma nzuri, maji na umeme hakuna shida", date: "2024-01-05", verified: false }
      ]);
      
      // Agent/Landlord Information
      const agent = {
        name: "James Anderson",
        phone: "+255712345678",
        whatsapp: "+255712345678",
        email: "james@houseLink.co.tz",
        verified: true,
        rating: 4.8,
        reviews: 42,
        memberSince: "2020",
        profileImage: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop"
      };
      
      useEffect(() => {
        // Load similar properties
        const similar = listings.filter(p => 
          p.id !== property.id && 
          p.location === property.location
        ).slice(0, 4);
        setSimilarProperties(similar);
      }, [property]);
      
      const handleScheduleViewing = (formData) => {
        toast("Uangalizi umepangwa kikamilifu. Mmiliki atakupigia simu", { variant: 'success' });
        // In production: Send to backend
        console.log('Viewing scheduled:', formData);
      };
      
      const handleContactAgent = () => {
        window.open(`https://wa.me/${agent.whatsapp}?text=Habari! Naomba maelezo zaidi kuhusu nyumba: ${property.title}`, '_blank');
      };
      
      const handleBookTour = () => {
        setShowScheduleModal(true);
      };
      
      const handleSaveProperty = () => {
        // Add to favorites
        const favs = new Set(load(LS.FAVS, []));
        favs.add(property.id);
        save(LS.FAVS, [...favs]);
        toast("Nyumba imehifadhiwa kwenye vipendwa", { variant: 'success' });
      };
      
      const handleShare = () => {
        if (navigator.share) {
          navigator.share({
            title: property.title,
            text: `Tazama nyumba hii kwenye HouseLink: ${property.title} - ${formatPrice(property.price)}/mwezi`,
            url: window.location.href,
          });
        } else {
          navigator.clipboard.writeText(window.location.href);
          toast("Link imenakiliwa", { variant: 'success' });
        }
      };
      
      const handleReport = () => {
        const reason = prompt("Tafadhali eleza kwa nini unaripoti tangazo hili:");
        if (reason) {
          toast("Asante kwa kuripoti. Tutaichunguza taarifa yako.", { variant: 'info' });
        }
      };
      
      // Render rating stars
      const renderStars = (rating) => {
        return Array(5).fill(0).map((_, i) => (
          <i 
            key={i} 
            className={`fas fa-star ${i < rating ? 'text-yellow-400' : 'text-gray-300'}`}
          ></i>
        ));
      };
      
      return (
        <div className="max-w-7xl mx-auto px-4 py-8">
          {/* Breadcrumb */}
          <nav className="flex mb-6 text-sm">
            <Link to="/" className="text-teal-600 hover:underline">Nyumbani</Link>
            <span className="mx-2">/</span>
            <Link to="/listings" className="text-teal-600 hover:underline">Orodha ya Nyumba</Link>
            <span className="mx-2">/</span>
            <span className="text-gray-600">{property.title}</span>
          </nav>
          
          {/* Property Header */}
          <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-start">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">{property.title}</h1>
                <div className="flex items-center gap-4 mt-2">
                  <span className="text-2xl font-bold text-teal-600">{formatPrice(property.price)}<span className="text-lg text-gray-600">/mwezi</span></span>
                  <span className="flex items-center gap-1">
                    {renderStars(4.5)}
                    <span className="text-gray-600 ml-2">(4.5)</span>
                  </span>
                  <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                    Inapatikana Sasa
                  </span>
                </div>
                <div className="flex items-center gap-4 mt-4 text-gray-600">
                  <span><i className="fas fa-map-marker-alt text-teal-600"></i> {property.location}</span>
                  <span><i className="fas fa-bed text-teal-600"></i> {property.bedrooms || '1'} Chumba</span>
                  <span><i className="fas fa-bath text-teal-600"></i> {property.bathrooms || '1'} Bafu</span>
                  <span><i className="fas fa-ruler-combined text-teal-600"></i> {property.area || '45'} m²</span>
                </div>
              </div>
              
              {/* Action Buttons */}
              <div className="flex gap-3">
                <button onClick={handleSaveProperty} className="p-3 border rounded-lg hover:bg-gray-50">
                  <i className="far fa-heart text-xl"></i>
                </button>
                <button onClick={handleShare} className="p-3 border rounded-lg hover:bg-gray-50">
                  <i className="fas fa-share-alt text-xl"></i>
                </button>
                <button onClick={handlePrint} className="p-3 border rounded-lg hover:bg-gray-50 no-print">
                  <i className="fas fa-print text-xl"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            {/* Left Column: Images & Details */}
            <div className="lg:col-span-2">
              {/* Image Gallery */}
              <div className="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
                <div className="gallery-main">
                  <img 
                    src={property.images[activeImage]} 
                    alt={property.title}
                    className="w-full h-full object-cover"
                  />
                  <div className="absolute bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full">
                    {activeImage + 1} / {property.images.length}
                  </div>
                </div>
                
                <div className="p-4">
                  <div className="image-gallery">
                    {property.images.map((img, idx) => (
                      <div 
                        key={idx}
                        className={`gallery-thumbnail ${activeImage === idx ? 'active' : ''}`}
                        onClick={() => setActiveImage(idx)}
                      >
                        <img src={img} alt={`${property.title} ${idx + 1}`} />
                      </div>
                    ))}
                  </div>
                </div>
              </div>
              
              {/* Property Description */}
              <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 className="text-xl font-bold mb-4">Maelezo</h2>
                <p className="text-gray-700 mb-6">{property.description}</p>
                
                <h3 className="text-lg font-bold mb-4">Vifaa na Huduma</h3>
                <div className="features-grid">
                  {CONFIG.AMENITIES.map(amenity => {
                    if (property[amenity.id]) {
                      return (
                        <div key={amenity.id} className="feature-item">
                          <i className={`fas ${amenity.icon} text-teal-600`}></i>
                          <span>{amenity.label}</span>
                        </div>
                      );
                    }
                    return null;
                  })}
                </div>
              </div>
              
              {/* Location & Map */}
              <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold">Eneo na Usafiri</h2>
                  <button 
                    onClick={() => setShowMap(!showMap)}
                    className="text-teal-600 hover:text-teal-700 font-medium"
                  >
                    {showMap ? 'Ficha Ramani' : 'Onyesha Ramani'}
                  </button>
                </div>
                
                {showMap ? (
                  <div className="map-container mb-4">
                    <PropertyMap 
                      properties={[property]}
                      selectedProperty={property}
                    />
                  </div>
                ) : (
                  <div className="space-y-4">
                    <div className="flex items-center gap-3 p-3 border rounded-lg">
                      <i className="fas fa-bus text-blue-600 text-xl"></i>
                      <div>
                        <h4 className="font-medium">Usafiri wa Umma</h4>
                        <p className="text-sm text-gray-600">Daladala 200m, Teksi 500m</p>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-3 p-3 border rounded-lg">
                      <i className="fas fa-school text-green-600 text-xl"></i>
                      <div>
                        <h4 className="font-medium">Shule</h4>
                        <p className="text-sm text-gray-600">Shule ya Msingi Sinza 800m</p>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-3 p-3 border rounded-lg">
                      <i className="fas fa-hospital text-red-600 text-xl"></i>
                      <div>
                        <h4 className="font-medium">Hospitali</h4>
                        <p className="text-sm text-gray-600">Muhimbili 2.5km</p>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-3 p-3 border rounded-lg">
                      <i className="fas fa-shopping-cart text-purple-600 text-xl"></i>
                      <div>
                        <h4 className="font-medium">Maduka</h4>
                        <p className="text-sm text-gray-600">Nakumatt Sinza 1.2km</p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
              
              {/* Reviews */}
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-bold">Ukadiriaji na Maoni</h2>
                  <button className="text-teal-600 hover:text-teal-700 font-medium">
                    Andika Ukadiriaji
                  </button>
                </div>
                
                <div className="flex items-center gap-6 mb-6 p-4 bg-gray-50 rounded-lg">
                  <div className="text-center">
                    <div className="text-5xl font-bold text-gray-900">4.5</div>
                    <div className="flex mt-2">
                      {renderStars(4.5)}
                    </div>
                    <div className="text-sm text-gray-600 mt-2">Kulingana na maoni 12</div>
                  </div>
                  
                  <div className="flex-1">
                    {[5,4,3,2,1].map(stars => (
                      <div key={stars} className="flex items-center gap-2 mb-1">
                        <span className="text-sm text-gray-600 w-8">{stars}</span>
                        <div className="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                          <div 
                            className="h-full bg-yellow-400"
                            style={{ width: `${stars === 5 ? '80%' : stars === 4 ? '15%' : stars === 3 ? '5%' : '0%'}` }}
                          ></div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                
                <div className="space-y-6">
                  {reviews.map(review => (
                    <div key={review.id} className="border-b pb-6">
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <h4 className="font-medium">{review.name}</h4>
                          {review.verified && (
                            <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Imethibitishwa</span>
                          )}
                        </div>
                        <div className="flex">
                          {renderStars(review.rating)}
                        </div>
                      </div>
                      <p className="text-gray-700 mb-2">{review.comment}</p>
                      <div className="text-sm text-gray-500">{review.date}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
            
            {/* Right Column: Agent & Actions */}
            <div className="space-y-6">
              {/* Agent Card */}
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex items-center gap-4 mb-6">
                  <img 
                    src={agent.profileImage} 
                    alt={agent.name}
                    className="w-16 h-16 rounded-full object-cover"
                  />
                  <div>
                    <h3 className="font-bold text-lg">{agent.name}</h3>
                    <div className="flex items-center gap-2 mt-1">
                      <span className="verified-badge">
                        <i className="fas fa-check-circle"></i> Wakala Aliyethibitishwa
                      </span>
                      <span className="text-sm text-gray-600">Alijiunga {agent.memberSince}</span>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-4">
                  <button 
                    onClick={handleBookTour}
                    className="w-full bg-gradient-to-r from-teal-600 to-green-600 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition"
                  >
                    <i className="fas fa-calendar-alt mr-2"></i>Panga Uangalizi
                  </button>
                  
                  <button 
                    onClick={handleContactAgent}
                    className="w-full border-2 border-teal-600 text-teal-600 py-3 rounded-lg font-semibold hover:bg-teal-50 transition"
                  >
                    <i className="fab fa-whatsapp mr-2"></i>Piga Simu Kupitia WhatsApp
                  </button>
                  
                  <button className="w-full border border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50 transition">
                    <i className="fas fa-phone-alt mr-2"></i>Piga Simu Moja kwa Moja
                  </button>
                  
                  <button className="w-full border border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50 transition">
                    <i className="fas fa-envelope mr-2"></i>Tuma Barua Pepe
                  </button>
                </div>
                
                <div className="mt-6 pt-6 border-t">
                  <h4 className="font-medium mb-4">Alama ya Uaminifu</h4>
                  <div className="space-y-3">
                    <div className="flex justify-between">
                      <span className="text-gray-600">Ukadiriaji wa Wakala</span>
                      <span className="font-semibold">{agent.rating}/5</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Majibu ya Haraka</span>
                      <span className="font-semibold">>2 saa</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Idadi ya Maoni</span>
                      <span className="font-semibold">{agent.reviews}+</span>
                    </div>
                  </div>
                </div>
              </div>
              
              {/* Price Breakdown */}
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h3 className="font-bold text-lg mb-4">Gharama zote</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-gray-600">Kodi ya Mwezi</span>
                    <span className="font-semibold">{formatPrice(property.price)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Amana</span>
                    <span className="font-semibold">{formatPrice(property.price * 2)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Ada ya Uwakala</span>
                    <span className="font-semibold">{formatPrice(property.price * 0.5)}</span>
                  </div>
                  <div className="border-t pt-3">
                    <div className="flex justify-between">
                      <span className="font-bold">Jumla ya Mwanzo</span>
                      <span className="font-bold text-teal-600">{formatPrice(property.price * 3.5)}</span>
                    </div>
                  </div>
                </div>
                
                <button className="w-full mt-6 bg-gray-900 text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition">
                  <i className="fas fa-calculator mr-2"></i>Kikokotoo cha Uwezo wa Kukodisha
                </button>
              </div>
              
              {/* Safety Tips */}
              <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                <h3 className="font-bold text-lg mb-3 text-yellow-800">
                  <i className="fas fa-shield-alt mr-2"></i>Vidokezo vya Usalama
                </h3>
                <ul className="space-y-2 text-sm text-yellow-700">
                  <li><i className="fas fa-check-circle mr-2"></i>Kamwe usilipie pesa kabla ya kuona nyumba</li>
                  <li><i className="fas fa-check-circle mr-2"></i>Thibitisha utambulisho wa mmiliki/wakala</li>
                  <li><i className="fas fa-check-circle mr-2"></i>Peana pesa kwa mikopo rasmi pekee</li>
                  <li><i className="fas fa-check-circle mr-2"></i>Omba hati ya makubaliano kabla ya kulipa</li>
                  <li><i className="fas fa-check-circle mr-2"></i>Ripoti matangazo yasiyo na uhakika</li>
                </ul>
              </div>
            </div>
          </div>
          
          {/* Similar Properties */}
          {similarProperties.length > 0 && (
            <div className="mt-12">
              <h2 className="text-2xl font-bold mb-6">Nyumba Zinazofanana</h2>
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                {similarProperties.map(property => (
                  <ListingCard key={property.id} item={property} t={t} />
                ))}
              </div>
            </div>
          )}
          
          {/* Schedule Viewing Modal */}
          <ScheduleViewingModal 
            property={property}
            isOpen={showScheduleModal}
            onClose={() => setShowScheduleModal(false)}
            onSchedule={handleScheduleViewing}
          />
        </div>
      );
    };

    // ==================== LISTING CARD COMPONENT ====================
    const ListingCard = ({ item, t }) => {
      const [favs, toggleFav] = useFavorites();
      const toast = useToast();
      const history = useHistory();
      const isFav = favs.has(item.id);
      
      const handleCardClick = () => {
        history.push(`/listing/${item.id}`);
      };
      
      const handleFavoriteClick = (e) => {
        e.stopPropagation();
        toggleFav(item.id);
      };
      
      const handleQuickView = (e) => {
        e.stopPropagation();
        // Show quick view modal
        toast("Quick view inapatikana kwenye toleo la baadaye", { variant: 'info' });
      };
      
      return (
        <div 
          onClick={handleCardClick}
          className="bg-white rounded-xl shadow-md overflow-hidden cursor-pointer card-hover"
        >
          <div className="relative">
            <img 
              src={item.images[0] || "https://images.unsplash.com/photo-1560184897-ae75f418493e?w=800&h=600&fit=crop"} 
              alt={item.title}
              className="w-full h-56 object-cover"
            />
            
            {/* Badges */}
            <div className="absolute top-3 left-3 flex flex-col gap-2">
              {item.verified && (
                <span className="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                  <i className="fas fa-check-circle mr-1"></i> Verified
                </span>
              )}
              {item.urgent && (
                <span className="bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                  <i className="fas fa-clock mr-1"></i> Urgent
                </span>
              )}
              {item.featured && (
                <span className="bg-teal-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                  <i className="fas fa-star mr-1"></i> Featured
                </span>
              )}
            </div>
            
            {/* Action Buttons */}
            <div className="absolute top-3 right-3 flex flex-col gap-2">
              <button 
                onClick={handleFavoriteClick}
                className="bg-white p-2 rounded-full shadow-lg hover:bg-gray-50"
              >
                <i className={`fas fa-heart ${isFav ? 'text-red-500' : 'text-gray-400'}`}></i>
              </button>
              <button 
                onClick={handleQuickView}
                className="bg-white p-2 rounded-full shadow-lg hover:bg-gray-50"
              >
                <i className="fas fa-eye text-gray-600"></i>
              </button>
            </div>
            
            {/* Price Badge */}
            <div className="absolute bottom-3 left-3 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg">
              <span className="text-xl font-bold">{formatPrice(item.price)}</span>
              <span className="text-sm">/mwezi</span>
            </div>
          </div>
          
          <div className="p-4">
            <h3 className="font-bold text-lg mb-1 truncate">{item.title}</h3>
            <div className="flex items-center text-gray-600 text-sm mb-3">
              <i className="fas fa-map-marker-alt text-teal-600 mr-2"></i>
              <span>{item.location}</span>
            </div>
            
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-4 text-sm text-gray-600">
                <span><i className="fas fa-bed mr-1"></i> {item.bedrooms || '1'}</span>
                <span><i className="fas fa-bath mr-1"></i> {item.bathrooms || '1'}</span>
                <span><i className="fas fa-ruler-combined mr-1"></i> {item.area || '45'} m²</span>
              </div>
              
              <div className="flex items-center">
                <i className="fas fa-star text-yellow-400 text-sm mr-1"></i>
                <span className="text-sm font-medium">4.5</span>
              </div>
            </div>
            
            {/* Amenity Tags */}
            <div className="flex flex-wrap gap-2">
              {item.water && <span className="bg-teal-100 text-teal-800 px-2 py-1 rounded-full text-xs">Maji 24/7</span>}
              {item.security && <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">Ulinzi</span>}
              {item.parking && <span className="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Parking</span>}
              {item.wifi && <span className="bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-xs">Wi-Fi</span>}
            </div>
          </div>
        </div>
      );
    };

    // ==================== MAIN APP COMPONENT ====================
    const App = () => {
      const [dark, toggleDark] = useDarkMode();
      const [lang, toggleLang, t] = useLanguage();
      const [listings, setListings] = useState(load(LS.LISTINGS, []));
      const [filteredListings, setFilteredListings] = useState([]);
      const [filters, setFilters] = useState({});
      const [viewMode, setViewMode] = useState('list'); // 'list' or 'map'
      const [selectedProperty, setSelectedProperty] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const toast = useToast();
      const { user, login, logout } = useAuth();
      
      // Initialize with sample data if empty
      useEffect(() => {
        if (listings.length === 0) {
          const sampleListings = [
            {
              id: 1,
              title: "Bedsitter Sinza Karibu na Chuo",
              location: "Sinza",
              price: 135000,
              type: "Bedsitter",
              bedrooms: "Studio",
              bathrooms: "1",
              area: "45",
              images: [
                "https://images.unsplash.com/photo-1560184897-ae75f418493e?w=800&h=600&fit=crop",
                "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&h=600&fit=crop"
              ],
              phone: "+255712345678",
              whatsapp: "+255712345678",
              description: "Bedsitter nzuri Sinza, maji 24/7, karibu na chuo kikuu, umeme wa kudumu, usalama mzuri. Inafaa kwa mwanafunzi au mtu binafsi.",
              views: 312,
              featured: true,
              verified: true,
              urgent: false,
              water: true,
              security: true,
              parking: true,
              wifi: true,
              furnished: true,
              createdAt: "2024-01-15T10:30:00Z",
              coordinates: [-6.7924, 39.2083]
            },
            // Add more sample listings...
          ];
          setListings(sampleListings);
          setFilteredListings(sampleListings);
          save(LS.LISTINGS, sampleListings);
        } else {
          setFilteredListings(listings);
        }
      }, []);
      
      // Apply filters
      useEffect(() => {
        let filtered = [...listings];
        
        // Search query
        if (searchQuery) {
          filtered = filtered.filter(item =>
            item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
            item.location.toLowerCase().includes(searchQuery.toLowerCase()) ||
            item.description.toLowerCase().includes(searchQuery.toLowerCase())
          );
        }
        
        // Location filter
        if (filters.location) {
          filtered = filtered.filter(item => item.location === filters.location);
        }
        
        // Type filter
        if (filters.type) {
          filtered = filtered.filter(item => item.type === filters.type);
        }
        
        // Price range
        if (filters.minPrice) {
          filtered = filtered.filter(item => item.price >= parseInt(filters.minPrice));
        }
        if (filters.maxPrice) {
          filtered = filtered.filter(item => item.price <= parseInt(filters.maxPrice));
        }
        
        // Bedrooms
        if (filters.bedrooms) {
          filtered = filtered.filter(item => item.bedrooms === filters.bedrooms);
        }
        
        // Amenities
        if (filters.amenities && filters.amenities.length > 0) {
          filtered = filtered.filter(item =>
            filters.amenities.every(amenity => item[amenity])
          );
        }
        
        setFilteredListings(filtered);
      }, [filters, searchQuery, listings]);
      
      const handleFilterChange = (key, value) => {
        setFilters(prev => ({ ...prev, [key]: value }));
      };
      
      const handleClearFilters = () => {
        setFilters({});
        setSearchQuery('');
      };
      
      const handleSearch = (e) => {
        e.preventDefault();
        // Search is already handled by useEffect
      };
      
      const handleCreateListing = (listingData) => {
        const newListing = {
          ...listingData,
          id: Date.now(),
          createdAt: new Date().toISOString(),
          views: 0,
          verified: false,
          coordinates: getCoordinates(listingData.location)
        };
        
        const updatedListings = [newListing, ...listings];
        setListings(updatedListings);
        setFilteredListings(updatedListings);
        save(LS.LISTINGS, updatedListings);
        
        toast("Tangazo limewekwa kikamilifu!", { variant: 'success' });
      };
      
      const handlePropertySelect = (property) => {
        setSelectedProperty(property);
        if (viewMode === 'map') {
          setViewMode('list');
        }
      };
      
      return (
        <HashRouter>
          <div className="min-h-screen flex flex-col">
            {/* Header */}
            <header className="gradient-bg text-white sticky top-0 z-50 shadow-lg">
              <div className="container mx-auto px-4 py-4">
                <div className="flex justify-between items-center">
                  <Link to="/" className="flex items-center gap-3">
                    <i className="fas fa-home text-3xl"></i>
                    <div>
                      <h1 className="text-2xl font-bold">HouseLink</h1>
                      <p className="text-sm opacity-90">Nyumba Bora Tanzania</p>
                    </div>
                  </Link>
                  
                  <div className="hidden md:flex items-center gap-6">
                    <Link to="/listings" className="hover:opacity-80">Orodha</Link>
                    <Link to="/upload" className="bg-white text-teal-600 px-6 py-2 rounded-full font-bold">
                      <i className="fas fa-plus mr-2"></i>TANGAZA NYUMBA
                    </Link>
                    <Link to="/favorites" className="relative">
                      <i className="fas fa-heart text-xl"></i>
                      <span className="absolute -top-2 -right-2 bg-red-600 text-xs rounded-full w-6 h-6 flex items-center justify-center">
                        {load(LS.FAVS, []).length}
                      </span>
                    </Link>
                    {user ? (
                      <div className="flex items-center gap-3">
                        <span>{user.name}</span>
                        <button onClick={logout} className="hover:opacity-80">
                          <i className="fas fa-sign-out-alt"></i>
                        </button>
                      </div>
                    ) : (
                      <Link to="/login" className="hover:opacity-80">
                        <i className="fas fa-user-circle text-xl"></i>
                      </Link>
                    )}
                    <button onClick={toggleDark} className="text-xl">
                      {dark ? '☀️' : '🌙'}
                    </button>
                    <button onClick={toggleLang} className="font-bold">
                      {lang === 'sw' ? 'EN' : 'SW'}
                    </button>
                  </div>
                </div>
              </div>
            </header>
            
            <Switch>
              {/* Home Page */}
              <Route exact path="/" render={() => (
                <div>
                  {/* Hero Search */}
                  <div className="relative h-96 bg-gradient-to-r from-teal-600 to-cyan-600 flex items-center">
                    <div className="container mx-auto px-4 text-center text-white">
                      <h2 className="text-4xl md:text-5xl font-bold mb-6">Pata Nyumba Bora Tanzania</h2>
                      <p className="text-xl mb-8">Dar es Salaam • Arusha • Mwanza • Dodoma</p>
                      
                      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow-xl p-4">
                        <form onSubmit={handleSearch} className="flex flex-col md:flex-row gap-4">
                          <input
                            type="text"
                            placeholder="Tafuta kwa eneo, aina ya nyumba, au bei..."
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            className="flex-1 p-3 border rounded-lg"
                          />
                          <button type="submit" className="bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold">
                            <i className="fas fa-search mr-2"></i>Tafuta
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                  
                  {/* Featured Listings */}
                  <div className="container mx-auto px-4 py-12">
                    <div className="flex justify-between items-center mb-8">
                      <h2 className="text-3xl font-bold">Nyumba Zilizoangaziwa</h2>
                      <Link to="/listings" className="text-teal-600 hover:underline">
                        Tazama zote <i className="fas fa-arrow-right ml-2"></i>
                      </Link>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                      {listings.filter(l => l.featured).slice(0, 4).map(l => (
                        <ListingCard key={l.id} item={l} t={t} />
                      ))}
                    </div>
                  </div>
                </div>
              )} />
              
              {/* Listings Page */}
              <Route exact path="/listings" render={() => (
                <div className="container mx-auto px-4 py-8">
                  <div className="flex justify-between items-center mb-6">
                    <h1 className="text-3xl font-bold">Orodha ya Nyumba</h1>
                    <div className="flex gap-4">
                      <button
                        onClick={() => setViewMode('list')}
                        className={`px-4 py-2 rounded-lg ${viewMode === 'list' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`}
                      >
                        <i className="fas fa-list mr-2"></i>Orodha
                      </button>
                      <button
                        onClick={() => setViewMode('map')}
                        className={`px-4 py-2 rounded-lg ${viewMode === 'map' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`}
                      >
                        <i className="fas fa-map mr-2"></i>Ramani
                      </button>
                    </div>
                  </div>
                  
                  <AdvancedFilters 
                    filters={filters}
                    onFilterChange={handleFilterChange}
                    onClearFilters={handleClearFilters}
                  />
                  
                  {viewMode === 'map' ? (
                    <div className="bg-white rounded-xl shadow-lg p-4">
                      <div className="map-container" style={{ height: '600px' }}>
                        <PropertyMap 
                          properties={filteredListings}
                          selectedProperty={selectedProperty}
                          onPropertySelect={handlePropertySelect}
                        />
                      </div>
                    </div>
                  ) : (
                    <>
                      <div className="mb-6 text-gray-600">
                        Nyumba {filteredListings.length} zilizopatikana
                      </div>
                      
                      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        {filteredListings.map(listing => (
                          <ListingCard 
                            key={listing.id} 
                            item={listing} 
                            t={t}
                            onClick={() => handlePropertySelect(listing)}
                          />
                        ))}
                      </div>
                      
                      {filteredListings.length === 0 && (
                        <div className="text-center py-12">
                          <i className="fas fa-search text-gray-400 text-6xl mb-4"></i>
                          <h3 className="text-xl font-bold mb-2">Hakuna nyumba zilizopatikana</h3>
                          <p className="text-gray-600 mb-6">Badilisha vichujio vyako au</p>
                          <Link to="/upload" className="bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold">
                            <i className="fas fa-plus mr-2"></i>TANGAZA NYUMBA MPYA
                          </Link>
                        </div>
                      )}
                    </>
                  )}
                </div>
              )} />
              
              {/* Property Detail Page */}
              <Route exact path="/listing/:id" render={({ match }) => {
                const listing = listings.find(l => l.id === parseInt(match.params.id));
                if (!listing) {
                  return (
                    <div className="container mx-auto px-4 py-12 text-center">
                      <h2 className="text-2xl font-bold mb-4">Tangazo halipatikani</h2>
                      <Link to="/listings" className="text-teal-600 hover:underline">
                        Rudi kwenye orodha
                      </Link>
                    </div>
                  );
                }
                return <PropertyDetail property={listing} t={t} />;
              }} />
              
              {/* Upload Page */}
              <Route exact path="/upload" render={() => (
                <UploadForm onSubmit={handleCreateListing} t={t} />
              )} />
              
              {/* Favorites Page */}
              <Route exact path="/favorites" render={() => (
                <div className="container mx-auto px-4 py-8">
                  <h1 className="text-3xl font-bold mb-6">Nyumba Zilizohifadhiwa</h1>
                  {load(LS.FAVS, []).length === 0 ? (
                    <div className="text-center py-12">
                      <i className="far fa-heart text-gray-400 text-6xl mb-4"></i>
                      <h3 className="text-xl font-bold mb-2">Hakuna nyumba ulizoweka kwenye vipendwa</h3>
                      <p className="text-gray-600 mb-6">Bonyeza kwenye alama ya moyo kwenye tangazo lolote ili kulihifadhi hapa</p>
                      <Link to="/listings" className="bg-teal-600 text-white px-6 py-3 rounded-lg font-semibold">
                        <i className="fas fa-search mr-2"></i>TAFUTA NYUMBA
                      </Link>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                      {listings.filter(l => load(LS.FAVS, []).includes(l.id)).map(listing => (
                        <ListingCard key={listing.id} item={listing} t={t} />
                      ))}
                    </div>
                  )}
                </div>
              )} />
            </Switch>
            
            {/* Footer */}
            <footer className="bg-gray-900 text-white mt-auto">
              <div className="container mx-auto px-4 py-12">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                  <div>
                    <h3 className="text-xl font-bold mb-4">HouseLink</h3>
                    <p className="text-gray-400">Tovuti ya mali isiyohamishika inayokusaidia kupata nyumba bora Tanzania.</p>
                    <div className="flex gap-4 mt-6">
                      <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-facebook-f"></i></a>
                      <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-twitter"></i></a>
                      <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-instagram"></i></a>
                      <a href="#" className="text-gray-400 hover:text-white"><i className="fab fa-linkedin"></i></a>
                    </div>
                  </div>
                  
                  <div>
                    <h4 className="font-bold mb-4">Miji Mikubwa</h4>
                    <ul className="space-y-2 text-gray-400">
                      <li><a href="#" className="hover:text-white">Dar es Salaam</a></li>
                      <li><a href="#" className="hover:text-white">Arusha</a></li>
                      <li><a href="#" className="hover:text-white">Mwanza</a></li>
                      <li><a href="#" className="hover:text-white">Dodoma</a></li>
                      <li><a href="#" className="hover:text-white">Mbeya</a></li>
                    </ul>
                  </div>
                  
                  <div>
                    <h4 className="font-bold mb-4">Weka Tangazo</h4>
                    <ul className="space-y-2 text-gray-400">
                      <li><a href="/upload" className="hover:text-white">Weka Tangazo</a></li>
                      <li><a href="#" className="hover:text-white">Bei za Soko</a></li>
                      <li><a href="#" className="hover:text-white">Mwongozo wa Mmiliki</a></li>
                      <li><a href="#" className="hover:text-white">Tuzo za Wakala</a></li>
                    </ul>
                  </div>
                  
                  <div>
                    <h4 className="font-bold mb-4">Usaidizi</h4>
                    <ul className="space-y-2 text-gray-400">
                      <li><a href="#" className="hover:text-white">Maswali Yanayoulizwa</a></li>
                      <li><a href="#" className="hover:text-white">Vidokezo vya Usalama</a></li>
                      <li><a href="#" className="hover:text-white">Wasiliana Nasi</a></li>
                      <li><a href="#" className="hover:text-white">Taarifa za Udanganyifu</a></li>
                    </ul>
                  </div>
                </div>
                
                <div className="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                  <p>© 2024 HouseLink Tanzania. Haki zote zimehifadhiwa.</p>
                </div>
              </div>
            </footer>
            
            {/* Floating Action Buttons */}
            <button 
              onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
              className="fixed bottom-8 right-8 bg-teal-600 text-white p-4 rounded-full shadow-lg hover:bg-teal-700"
            >
              <i className="fas fa-chevron-up"></i>
            </button>
            
            <Link 
              to="/upload"
              className="fixed bottom-8 left-8 bg-white text-teal-600 p-4 rounded-full shadow-lg hover:bg-gray-50 flex items-center gap-2"
            >
              <i className="fas fa-plus"></i>
              <span className="hidden md:inline">Weka Tangazo</span>
            </Link>
          </div>
        </HashRouter>
      );
    };

    // ==================== ROOT COMPONENT ====================
    const Root = () => (
      <ToastProvider>
        <AuthProvider>
          <MapProvider>
            <App />
          </MapProvider>
        </AuthProvider>
      </ToastProvider>
    );

    // Render the application
    ReactDOM.render(<Root />, document.getElementById('root'));
  </script>
</body>
</html>
