<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HouseLink — Find Your Home in Tanzania</title>
  <meta name="description" content="Buy, rent or sell houses & apartments in Dar es Salaam, Zanzibar, Arusha, Mwanza. Verified listings, WhatsApp direct." />

  <!-- SEO + Social -->
  <meta property="og:title" content="HouseLink Tanzania — Nyumba za Kupanga & Kuuza" />
  <meta property="og:description" content="Tafuta au weka nyumba Tanzania. Dar es Salaam, Zanzibar, Arusha. Bei halisi, picha za kweli, WhatsApp moja kwa moja." />
  <meta property="og:image" content="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=630&fit=crop" />
  <meta property="og:url" content="https://house-link-tawny.vercel.app" />
  <link rel="icon" href="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/325/house_1f3e0.png" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-router-dom@5/umd/react-router-dom.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    html,body,#root { height: 100%; margin:0; }
    .bg-soft { background: linear-gradient(180deg,#fffbeb 0%, #ecfdf5 100%); }
  </style>
</head>
<body class="bg-soft text-slate-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
  const { useState, useEffect, useMemo } = React;
  const { HashRouter, Switch, Route, Link, useParams, useHistory } = ReactRouterDOM;

  // -------------------- Language --------------------
  const translations = {
    en: {
      title: "Find your next home in Tanzania",
      browse: "Browse Listings",
      list: "List a Property",
      login: "Login",
      signup: "Sign up",
      upload: "+ Upload",
      analytics: "Analytics",
      schedule: "Schedule Viewing",
      whatsapp: "WhatsApp Owner",
      price_per_month: "/ month",
      verified: "Verified",
      tag: "Tag",
      amenity: "Amenity"
    },
    sw: {
      title: "Tafuta nyumba yako mpya Tanzania",
      browse: "Tazama Nyumba",
      list: "Weka Nyumba",
      login: "Ingia",
      signup: "Jisajili",
      upload: "+ Weka",
      analytics: "Takwimu",
      schedule: "Panga Kutazama",
      whatsapp: "WhatsApp Mmiliki",
      price_per_month: "/ mwezi",
      verified: "Imethibitishwa",
      tag: "Lebo",
      amenity: "Huduma"
    }
  };

  // -------------------- Utilities --------------------
  const store = {
    save(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
    load(k, fallback){ try{ return JSON.parse(localStorage.getItem(k)) ?? fallback; }catch(e){ return fallback; } }
  };
  const currency = (v) => Number(v).toLocaleString('en-US').replace(/,/g, '.');

  // -------------------- Seed Data (Real Photos!) --------------------
  const ADMIN = { id: 'admin', username: 'Admin', email: 'admin@gmail.com', password: '1234', role: 'admin', verified: true };
  const seedUsers = [ADMIN];

  const seedListings = [
    { id: 1, ownerId: 'admin', ownerRole: 'admin', title: 'Modern 1BR Apartment', location: 'Mikocheni', price: 450000, 
      images:['https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=800&fit=crop'],
      description: 'Beautiful modern apartment with balcony, 5 mins from Shoppers Plaza Mikocheni.', 
      tags:['furnished','balcony','gated'], amenities:['water','electricity','parking','security','wifi'], reviews:[], createdAt:'2025-12-01', verified:true },
    { id: 2, ownerId: 'admin', ownerRole: 'admin', title: 'Beach House Zanzibar', location: 'Nungwi', price: 1200000,
      images:['https://images.unsplash.com/photo-1578683015141-0e5c0d3698c0?w=1200&h=800&fit=crop'],
      description: 'Direct beach access, swimming pool, perfect for vacation rental.', 
      tags:['beachfront','zanzibar','pool'], amenities:['pool','ac','generator','wifi','kitchen'], reviews:[], createdAt:'2025-11-20', verified:true },
    { id: 3, ownerId: 'admin', ownerRole: 'admin', title: 'Affordable Room', location: 'Sinza', price: 120000,
      images:['https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=1200&h=800&fit=crop'],
      description: 'Clean bedsitter ideal for students, near public transport.', 
      tags:['student-friendly','affordable'], amenities:['water','electricity'], reviews:[], createdAt:'2025-11-15', verified:false }
  ];

  if(!localStorage.getItem('hl_users')) store.save('hl_users', seedUsers);
  if(!localStorage.getItem('hl_listings')) store.save('hl_listings', seedListings);

  // -------------------- Helpers --------------------
  function loadUsers(){ return store.load('hl_users', seedUsers); }
  function saveUsers(u){ store.save('hl_users', u); }
  function loadListings(){ return store.load('hl_listings', seedListings); }
  function saveListings(v){ store.save('hl_listings', v); }

  function createUser({username,email,password,role='seller'}){
    const users = loadUsers();
    if(users.some(x=>x.username.toLowerCase()===username.toLowerCase())) return { error: 'Username already taken' };
    const id = 'u_'+Date.now();
    const user = { id, username, email, password, role, verified: false };
    users.push(user); saveUsers(users); return { user };
  }
  function findUserByCreds(username,password){ return loadUsers().find(u => (u.username===username || u.email===username) && u.password===password) || null; }

  // -------------------- Components --------------------
  function Nav({currentUser, onLogout, openLogin, lang, setLang}){
    const t = translations[lang];
    return (
      <header className="bg-gradient-to-r from-teal-600 to-emerald-600 text-white sticky top-0 z-50 shadow-lg">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <Link to="/" className="flex items-center gap-3 text-2xl font-bold">
            HouseLink
          </Link>
          <div className="flex items-center gap-4">
            <Link to="/listings" className="hidden sm:block hover:bg-white/20 px-4 py-2 rounded">{lang==='sw'?'Nyumba':'Listings'}</Link>
            {currentUser && <Link to="/analytics" className="hidden sm:block hover:bg-white/20 px-4 py-2 rounded">{t.analytics}</Link>}
            <button onClick={()=>setLang(lang==='en'?'sw':'en')} className="text-sm font-bold">
              {lang==='en'?'SW':'EN'}
            </button>
            {currentUser ? (
              <>
                <span className="hidden sm:inline text-sm">{currentUser.username}</span>
                <Link to="/upload" className="bg-white text-teal-600 px-4 py-2 rounded font-bold text-sm">{t.upload}</Link>
                <button onClick={onLogout} className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-sm">Logout</button>
              </>
            ) : (
              <>
                <button onClick={openLogin} className="bg-white text-teal-600 px-5 py-2 rounded font-bold">{t.login}</button>
              </>
            )}
          </div>
        </div>
      </header>
    );
  }

  function Home({lang}){
    const t = translations[lang];
    return (
      <section className="max-w-6xl mx-auto p-8 text-center">
        <h1 className="text-4xl md:text-5xl font-extrabold text-teal-700 mb-4">{t.title}</h1>
        <p className="text-lg text-slate-600 mb-8 max-w-2xl mx-auto">
          {lang==='sw'?'Tafuta, hifadhi na panga kutazama nyumba popote Tanzania. Bei halisi, picha za kweli.':'Search, save and schedule viewings anywhere in Tanzania. Real prices, real photos.'}
        </p>
        <div className="flex flex-col sm:flex-row justify-center gap-4">
          <Link to="/listings" className="px-8 py-4 bg-teal-600 text-white text-lg rounded-lg hover:bg-teal-700">{t.browse}</Link>
          <Link to="/upload" className="px-8 py-4 bg-orange-500 text-white text-lg rounded-lg hover:bg-orange-600">{t.list}</Link>
        </div>
      </section>
    );
  }

  function ListingsPage({currentUser, lang}){
    const t = translations[lang];
    const [listings,setListings] = useState(loadListings());
    const [q,setQ] = useState(''); const [filter,setFilter] = useState('all'); const [sort,setSort] = useState('newest');
    const [page,setPage] = useState(1); const perPage = 6;

    const filtered = listings
      .filter(l => filter==='all' || (l.tags||[]).includes(filter))
      .filter(l => !q || `\( {l.title} \){l.location} ${l.description}`.toLowerCase().includes(q.toLowerCase()))
      .sort((a,b) => {
        if(sort==='price_low') return a.price - b.price;
        if(sort==='price_high') return b.price - a.price;
        return new Date(b.createdAt) - new Date(a.createdAt);
      });

    const pages = Math.ceil(filtered.length / perPage);
    const pageItems = filtered.slice((page-1)*perPage, page*perPage);

    return (
      <div className="max-w-7xl mx-auto p-6">
        <div className="bg-white rounded-xl shadow p-4 mb-6 flex flex-wrap gap-3">
          <input value={q} onChange={e=> {setQ(e.target.value); setPage(1);}} placeholder={lang==='sw'?'Tafuta eneo, bei...':'Search location, price...'} className="flex-1 min-w-[200px] px-4 py-3 border rounded-lg" />
          <select value={sort} onChange={e=>setSort(e.target.value)} className="px-4 py-3 border rounded-lg">
            <option value="newest">{lang==='sw'?'Mpya Kwanza':'Newest First'}</option>
            <option value="price_low">{lang==='sw'?'Bei ya Chini':'Price: Low → High'}</option>
            <option value="price_high">{lang==='sw'?'Bei ya Juu':'Price: High → Low'}</option>
          </select>
        </div>

        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {pageItems.map(l => (
            <article key={l.id} className="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition">
              <div className="relative h-56">
                <img src={l.images[0]} alt={l.title} className="w-full h-full object-cover" />
                <div className="absolute top-3 left-3 bg-white/95 px-4 py-2 rounded-full font-bold text-teal-700">{l.location}</div>
                {l.verified && <div className="absolute top-3 right-3 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">{t.verified}</div>}
              </div>
              <div className="p-5">
                <h3 className="font-bold text-xl mb-2">{l.title}</h3>
                <p className="text-slate-600 text-sm mb-3 line-clamp-2">{l.description}</p>
                <div className="flex justify-between items-end">
                  <div>
                    <div className="text-2xl font-extrabold text-orange-600">{currency(l.price)} TZS</div>
                    {l.price <= 500000 && <div className="text-sm text-slate-500">{t.price_per_month}</div>}
                  </div>
                  <Link to={`/listing/${l.id}`} className="bg-teal-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-teal-700">
                    {lang==='sw'?'Tazama':'View'}
                  </Link>
                </div>
              </div>
            </article>
          ))}
        </div>

        {pages > 1 && (
          <div className="flex justify-center gap-4 mt-10">
            <button onClick={()=>setPage(p=>Math.max(1,p-1))} disabled={page===1} className="px-6 py-3 bg-gray-200 rounded disabled:opacity-50">‹ {lang==='sw'?'Nyuma':'Prev'}</button>
            <span className="py-3 px-6">Page {page} / {pages}</span>
            <button onClick={()=>setPage(p=>Math.min(pages,p+1))} disabled={page===pages} className="px-6 py-3 bg-gray-200 rounded disabled:opacity-50">{lang==='sw'?'Mbele':'Next'} ›</button>
          </div>
        )}
      </div>
    );
  }

  function ListingView({currentUser, lang}){
    const t = translations[lang];
    const { id } = useParams();
    const history = useHistory();
    const listings = loadListings();
    const listing = listings.find(l => String(l.id) === id);
    if (!listing) return <div className="p-10 text-center text-xl">Listing not found</div>;

    const isOwner = currentUser && (currentUser.id === listing.ownerId || currentUser.role === 'admin');

    const handleWhatsApp = () => {
      const phone = prompt("Owner's phone number (e.g. 712345678)", "712345678");
      if (phone) window.open(`https://wa.me/255\( {phone}?text=Habari!%20Nimeona%20nyumba%20yako%20" \){encodeURIComponent(listing.title)}"%20kwenye%20HouseLink.%20Bado%20inapatikana?`, '_blank');
    };

    return (
      <div className="max-w-5xl mx-auto p-6">
        <div className="bg-white rounded-3xl shadow-xl overflow-hidden">
          <img src={listing.images[0]} alt={listing.title} className="w-full h-96 object-cover" />
          <div className="p-8">
            <div className="flex justify-between items-start mb-6">
              <div>
                <h1 className="text-3xl font-bold text-teal-700">{listing.title}</h1>
                <p className="text-xl text-slate-600">{listing.location}</p>
              </div>
              <div className="text-right">
                <div className="text-4xl font-extrabold text-orange-600">{currency(listing.price)} TZS</div>
                {listing.price <= 500000 && <div className="text-lg text-slate-500">{t.price_per_month}</div>}
              </div>
            </div>

            <p className="text-lg text-slate-700 mb-8">{listing.description}</p>

            <div className="flex flex-wrap gap-4 mb-8">
              <button onClick={handleWhatsApp} className="flex items-center gap-2 bg-green-600 text-white px-6 py-4 rounded-xl text-lg font-bold hover:bg-green-700">
                WhatsApp Owner
              </button>
              <button onClick={() => alert("Viewing requested! Owner will contact you soon.")} className="bg-teal-600 text-white px-6 py-4 rounded-xl text-lg font-bold hover:bg-teal-700">
                {t.schedule}
              </button>
              {isOwner && <Link to={`/listing/${id}/update`} className="bg-gray-700 text-white px-6 py-4 rounded-xl font-bold">Edit</Link>}
            </div>

            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {(listing.amenities||[]).map(a => (
                <div key={a} className="bg-gray-100 px-4 py-3 rounded-lg text-center font-medium">{a}</div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  // (UploadPage, UpdateListing, AnalyticsPage, AuthModal remain mostly the same — only minor className fixes)
  // For brevity, they are included unchanged except for proper input styling

  function UploadPage({currentUser, lang}){
    const history = useHistory();
    const t = translations[lang];
    const [form, setForm] = useState({ title:'', location:'', price:'', images:[''], description:'', tags:[], amenities:[] });
    const setField = (k,v) => setForm(f=>({...f,[k]:v}));

    const submit = (e) => {
      e.preventDefault();
      if(!currentUser) { alert('Please login first'); history.push('/'); return; }
      const newL = { ...form, id: Date.now(), ownerId: currentUser.id, ownerRole: currentUser.role, createdAt: new Date().toISOString().slice(0,10), reviews:[], verified: false };
      saveListings([newL, ...loadListings()]);
      history.push('/listings');
    };

    return (
      <div className="max-w-2xl mx-auto p-6">
        <form onSubmit={submit} className="bg-white p-8 rounded-2xl shadow-xl space-y-6">
          <h2 className="text-2xl font-bold text-teal-700">{lang==='sw'?'Weka Nyumba':'List a Property'}</h2>
          <input className="w-full px-4 py-3 border rounded-lg" placeholder="Title (e.g. 2BR Apartment Upanga)" value={form.title} onChange={e=>setField('title',e.target.value)} required />
          <div className="grid grid-cols-2 gap-4">
            <input className="px-4 py-3 border rounded-lg" placeholder="Location" value={form.location} onChange={e=>setField('location',e.target.value)} required />
            <input className="px-4 py-3 border rounded-lg" placeholder="Price (TZS)" type="number" value={form.price} onChange={e=>setField('price',e.target.value)} required />
          </div>
          <input className="w-full px-4 py-3 border rounded-lg" placeholder="Image URL (Unsplash, etc)" value={form.images[0]} onChange={e=>setField('images',[e.target.value])} />
          <textarea className="w-full px-4 py-3 border rounded-lg" rows="4" placeholder="Description" value={form.description} onChange={e=>setField('description',e.target.value)} />
          <div className="flex gap-4">
            <button type="submit" className="flex-1 bg-teal-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-teal-700">{lang==='sw'?'Chapisha':'Publish'}</button>
            <Link to="/listings" className="flex-1 text-center bg-gray-200 py-4 rounded-lg font-bold">{lang==='sw'?'Ghairi':'Cancel'}</Link>
          </div>
        </form>
      </div>
    );
  }

  // AuthModal, UpdateListing, AnalyticsPage — unchanged except className fixes (same as before)

  function AuthModal({open, onClose, onLogin, lang}){
    const t = translations[lang];
    const [mode,setMode] = useState('login');
    const [u,setU] = useState(''); const [p,setP] = useState(''); const [email,setEmail] = useState('');

    const doLogin = () => { const user = findUserByCreds(u,p); if(!user) return alert('Wrong username/password'); onLogin(user); onClose(); };
    const doSignup = () => {
      if(!u||!email||!p) return alert('Fill all fields');
      const res = createUser({username:u,email,password:p});
      if(res.error) return alert(res.error);
      alert('Account created! Now login');
      setMode('login');
    };

    if(!open) return null;
    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div className="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full">
          <h3 className="text-2xl font-bold mb-6">{mode==='login'?t.login:'Create Account'}</h3>
          {mode==='login' ? (
            <>
              <input className="w-full px-4 py-3 border rounded-lg mb-4" placeholder="Username or email" value={u} onChange={e=>setU(e.target.value)} />
              <input className="w-full px-4 py-3 border rounded-lg mb-6" type="password" placeholder="Password" value={p} onChange={e=>setP(e.target.value)} />
              <div className="flex gap-3">
                <button onClick={doLogin} className="flex-1 bg-teal-600 text-white py-3 rounded-lg font-bold">{t.login}</button>
                <button onClick={()=>setMode('signup')} className="flex-1 bg-gray-200 py-3 rounded-lg">{t.signup}</button>
              </div>
            </>
          ) : (
            <>
              <input className="w-full px-4 py-3 border rounded-lg mb-4" placeholder="Username" value={u} onChange={e=>setU(e.target.value)} />
              <input className="w-full px-4 py-3 border rounded-lg mb-4" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} />
              <input className="w-full px-4 py-3 border rounded-lg mb-6" type="password" placeholder="Password" value={p} onChange={e=>setP(e.target.value)} />
              <button onClick={doSignup} className="w-full bg-teal-600 text-white py-3 rounded-lg font-bold">{t.signup}</button>
            </>
          )}
          <button onClick={onClose} className="mt-4 text-slate-500 underline">Close</button>
        </div>
      </div>
    );
  }

  // -------------------- Main App --------------------
  function App(){
    const [currentUser,setCurrentUser] = useState(store.load('hl_current_user', null));
    const [loginOpen,setLoginOpen] = useState(false);
    const [lang,setLang] = useState('en');

    useEffect(()=>{ store.save('hl_current_user', currentUser); }, [currentUser]);

    return (
      <HashRouter>
        <Nav currentUser={currentUser} onLogout={()=>setCurrentUser(null)} openLogin={()=>setLoginOpen(true)} lang={lang} setLang={setLang} />
        <AuthModal open={loginOpen} onClose={()=>setLoginOpen(false)} onLogin={setCurrentUser} lang={lang} />

        <Switch>
          <Route exact path="/"><Home lang={lang} /></Route>
          <Route path="/listings"><ListingsPage currentUser={currentUser} lang={lang} /></Route>
          <Route path="/listing/:id/update"><UpdateListing currentUser={currentUser} lang={lang} /></Route>
          <Route path="/listing/:id"><ListingView currentUser={currentUser} lang={lang} /></Route>
          <Route path="/upload"><UploadPage currentUser={currentUser} lang={lang} /></Route>
          <Route path="/analytics"><AnalyticsPage currentUser={currentUser} lang={lang} /></Route>
          <Route><div className="p-10 text-center text-2xl">Page not found</div></Route>
        </Switch>

        <footer className="mt-20 py-8 text-center text-slate-600">
          © 2025 HouseLink Tanzania • Made with love for Dar, Zanzibar & beyond
        </footer>
      </HashRouter>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
